<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSS only -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <title>Proiect IT</title>
    <link rel="stylesheet" type="text/css" href="main1.css">


</head>

<body>

  <section id="nav-bar">

    <img src="images/Asset 6 2.png" alt="background" class="img-fluid background-upper" >

    <nav class="navbar navbar-expand-lg navbar-light bg-light p-5 project_navbar">
        <img src="images/image 1.svg" alt="Bazaroo" class="logo img-fluid">

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav col-md-6 ml-auto d-flex align-items-center justify-content-around navigation-buttons" id="nav-buttons">
            <li class="nav-item btn btn-primary" data-toggle="modal" data-target="#login-modal">
              <a class="nav-link">Logare</a>
            </li>
            <li class="nav-item btn btn-primary" data-toggle="modal" data-target="#register-modal">
              <a class="nav-link">Creare Cont</a>
            </li>
            <li class="nav-item btn btn-primary">
              <a class="nav-link">Contact</a>
            </li>
          </ul>
        </div>
      </nav>

    </section>

    <section class="banner">
        <div class="container">
            <div class="row justify-content-between align-items-center">
                <div class="col-md-4 banner-title media-learn">
                    <h1>Învățatul nu a fost niciodată mai simplu!</h1>
                    <p>Platforma ideală pentru meditații online, atât pentru profesori, cât si pentru studenți.</p>
                </div>

                <div class="col-md-5 banner-img">
                    <img src="images/Asset 5 1.png" alt="background" class="img-middle img-fluid media-learn">
                </div>
            </div>
        </div>
    </section>

    <section id="function">
      <div class="container function text-center p-5">
        <div class="func-header">
            <h2>Cum funcționează?</h2>
        </div>

        <div class="row justify-content-around align-items-center">
            <div class="text-center func-card">
                <p class="func-card-text">Știi prea multe și vrei să predai?</p>
                <p class="func-card-text">Înscrie-te că profesor.</p>
                <a href="#">Predau</a>
            </div>

            <div class="text-center func-card">
                <p class="func-card-text">Știi prea puține și vrei să înveți?</p>
                <p class="func-card-text">Înscrie-te că student.</p>
                <a href="#">Învăț</a>
            </div>

            <div class="function-background container">
            </div>
        </div>
      </div>

    </section>
    
  <div class="container text-center my-3 modify-phone-opinions">
    <h2 class="font-weight-light style-opinii">Ce zic utilizatorii?</h2>
    <div class="row mx-auto my-auto">
        <div id="recipeCarousel" class="carousel slide w-100" data-ride="carousel">
            <div class="carousel-inner w-100" role="listbox" id="carousel-inner">

            </div>
            <a class="carousel-control-prev w-auto" href="#recipeCarousel" role="button" data-slide="prev">
                <!-- <span class="carousel-control-prev-icon bg-dark border border-dark rounded-circle" aria-hidden="true">
                </span> -->
                <i style="color:#272A45; font-size: 36px" class="fa fa-chevron-left"></i>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next w-auto" href="#recipeCarousel" role="button" data-slide="next">
                <!-- <span class="carousel-control-next-icon bg-dark border border-dark rounded-circle" aria-hidden="true"></span> -->
                <span class="sr-only">Next</span>
                <i style="color:#272A45; font-size: 36px" class="fa fa-chevron-right"></i>
            </a>
        </div>
    </div>
    
</div>

    <section id="contact">

      <div class="container">
        <div>
          <h3 class="text-primary text-center">Întâmpini dificultăți?</p>
          <h3 class="text-primary text-center">Contactează-ne!</p>
        </div>

        <div class="col-md-5 text-center mx-auto contact-div">
          <img src="images/Frame.png" alt="study" class="background-contact"/> 
          <form class="contact-form" id="contact-form">
            <div class="form-group row">
              <label for="input-name-contact" class="label-text col-sm-2 col-form-label text-left">Nume</label>
              <div class="col-sm-12">
                <input type="text" class="form-control input-element" id="input-name-contact">
              </div>
            </div>

            <div class="form-group row">
              <label for="input-email-contact" class="label-text col-sm-2 col-form-label text-left">Email</label>
              <div class="col-sm-12">
                <input type="email" class="form-control input-element" id="input-email-contact">
              </div>
            </div>

            <div class="form-group">
              <label for="input-mesaj-contact" class="label-text text-left w-100">Mesaj</label>
              <textarea class="form-control input-element" id="input-mesaj-contact" rows="3"></textarea>
            </div>

            <div class="alert alert-success" role="alert" id="success-toast">
              Mesaj trimis cu success.
            </div>
            <div class="alert alert-danger" role="alert" id="error-toast">
              Eroare la trimiterea mesajului.
            </div>

            <button type="submit" class="btn btn-primary btn-submit">Trimite</button>
          </form>
        </div>
      </div>
    </section>

    <footer class="lower">
        <img src="images/Asset 6 4.png" alt="background" class="background-lower img-responsive img-lower-media">
        <div class="socialise">
            <img src="images/Frame-3.png" alt="background" class="icons img-responsive icons-lower-media">
            <img src="images/Frame-4.png" alt="background" class="icons img-responsive icons-lower-media">
            <img src="images/Frame-5.png" alt="background" class="icons img-responsive icons-lower-media">
        </div>
    </footer>

    <div class="modal fade" id="register-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Register</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="register-form">

              <div class="form-group row">
                <label for="input-name-register" class="label-text col-sm-2 col-form-label text-left">Nume</label>
                <div class="col-sm-12">
                  <input type="text" class="form-control input-element" id="input-name-register">
                </div>
              </div>
  
              <div class="form-group row">
                <label for="input-firstname-register" class="label-text col-sm-2 col-form-label text-left">Prenume</label>
                <div class="col-sm-12">
                  <input type="text" class="form-control input-element" id="input-firstname-register">
                </div>
              </div>

              <div class="form-group row">
                <label for="input-email-register" class="label-text col-sm-2 col-form-label text-left">Email</label>
                <div class="col-sm-12">
                  <input type="email" class="form-control input-element" id="input-email-register">
                </div>
              </div>
  
              <div class="form-group row">
                <label for="input-password-register" class="label-text col-sm-2 col-form-label text-left">Parola</label>
                <div class="col-sm-12">
                  <input type="password" class="form-control input-element" id="input-password-register">
                </div>
              </div>

              <div class="form-group row">
                <label for="input-confirm-password" class="label-text col-sm-2 col-form-label text-left">Confirmare Parola</label>
                <div class="col-sm-12">
                  <input type="password" class="form-control input-element" id="input-confirm-password-register">
                </div>
              </div>

              
              <select class="form-select" aria-label="Default select example" id="register-type">
                <option selected value="student">Student</option>
                <option value="teacher">Teacher</option>
              </select>

              <br>

              <div class="alert alert-success" role="alert" id="success-toast-register">
                Mesaj trimis cu success.
              </div>
              <div class="alert alert-danger" role="alert" id="error-toast-register">
                Eroare la trimiterea mesajului.
              </div>

              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button class="btn btn-primary" type="submit">Register</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="login-form">

              <div class="form-group row">
                <label for="input-email-login" class="label-text col-sm-2 col-form-label text-left">Email</label>
                <div class="col-sm-12">
                  <input type="email" class="form-control input-element" id="input-email-login">
                </div>
              </div>
  
              <div class="form-group row">
                <label for="input-password-login" class="label-text col-sm-2 col-form-label text-left">Parola</label>
                <div class="col-sm-12">
                  <input type="password" class="form-control input-element" id="input-password-login">
                </div>
              </div>

              <div class="alert alert-success" role="alert" id="success-toast-login">
                Mesaj trimis cu success.
              </div>
              <div class="alert alert-danger" role="alert" id="error-toast-login">
                Eroare la trimiterea mesajului.
              </div>

              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button class="btn btn-primary" type="submit">Login</button>
            </form>
          </div>
        </div>
      </div>
    </div>


    <script src="https://kit.fontawesome.com/3a9f54b6ec.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script>
  let bobobc_token = "7011816a-4b9d-42cc-aced-669662af65a4";
  let url = "https://proba2021.lsacbucuresti.ro";
  let reviews = "https://proba2021.lsacbucuresti.ro/reviews";
  let normalNav= '<li class="nav-item btn btn-primary" data-toggle="modal" data-target="#login-modal">' +
              '<a class="nav-link">Logare</a>' +
            '</li>' +
            '<li class="nav-item btn btn-primary" data-toggle="modal" data-target="#register-modal">' +
              '<a class="nav-link">Creare Cont</a>' +
            '</li>' +
            '<li class="nav-item btn btn-primary">' +
              '<a class="nav-link">Contact</a>' +
            '</li>';

  let loggedStudentNavBar = '<li class="nav-item btn btn-primary">' +
              '<a class="nav-link" id="logout">Logout</a>' +
            '</li>' +
            '<li class="nav-item btn btn-primary">' +
              '<a class="nav-link" href="student.html">Dashboard</a>' +
            '</li>';

  let loggedTeacherNavBar = '<li class="nav-item btn btn-primary">' +
              '<a class="nav-link" id="logout">Logout</a>' +
            '</li>' +
            '<li class="nav-item btn btn-primary">' +
              '<a class="nav-link" href="profesor.html">Dashboard</a>' +
            '</li>';

  $(document).ready(() => {
    $('#error-toast').css('display', 'none');
    $('#success-toast').css('display', 'none');
    $('#success-toast-register').css('display', 'none');
    $('#error-toast-register').css('display', 'none');
    $('#success-toast-login').css('display', 'none');
    $('#error-toast-login').css('display', 'none');
    let type = window.localStorage.getItem("type")

    if (type !== undefined) {
      if (type === 'student') {
        $('#nav-buttons').html(loggedStudentNavBar);
      } else if (type === 'profesor') {
        $('#nav-buttons').html(loggedTeacherNavBar);
      }

      $('#logout').click(event => {
        event.preventDefault();
        window.localStorage.removeItem("token");
        window.localStorage.removeItem("type");

        $('#nav-buttons').html(normalNav);
      });
    }

    fetch(reviews, {
      method: 'GET',
      headers: {
        'Authorization': 'Bearer ' + bobobc_token, 
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'boboc-token': bobobc_token
      }
    }).then(response => response.json()).then(res => {
      res.forEach((el, index) => {

        let element = '<div class="carousel-item ' + (index === 0 ? 'active' : '') + '"> ' +
            '<div class="col-md-6">' +
                '<div class="card card-body images-carousel">' +
                    '<div class="row size-of-student">' +
                    '<img src="images/copil.svg" class="modif-student col-md-6 ">' +
                    '<p class="name-student col-md-6 ">' + el.user.firstname + '</p>' +
                    '</div>' +
                    '<p class="students-opinions">&emsp; Mi-am luat in sfarsit restanta!</p>' +
                '</div>' +
            '</div>' +
        '</div>';

        $('.carousel-inner').append(element);
      });

      $('#recipeCarousel').carousel({
        interval: 10000
      })

      $('.carousel .carousel-item').each(function(){
        var minPerSlide = 2;
        var next = $(this).next();
        if (!next.length) {
          next = $(this).siblings(':first');
        }

        next.children(':first-child').clone().appendTo($(this));
        
        for (var i = 0; i < minPerSlide; i++) {
            next = next.next();
            if (!next.length) {
              next = $(this).siblings(':first');
            }
            
            next.children(':first-child').clone().appendTo($(this));
          }
    });
    }).catch(err => console.log(err));
  })

  $("#contact-form").submit(event => {
    event.preventDefault();
    $('#error-toast').css('display', 'none');
    $('#success-toast').css('display', 'none');

    let email = $('#input-email-contact').val();
    let name = $('#input-name-contact').val();
    let msg = $('#input-mesaj-contact').val();

    fetch(url + '/contact-requests', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + bobobc_token, 
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'boboc-token': bobobc_token
      },
      body: JSON.stringify({
        "name": name,
        "email": email,
        "message": msg
        })
    }).then(response => {
      console.log(response);

      if (response.status < 200 || response.status >= 300) {
        $('#error-toast').css('display', 'block');
      } else {
        $('#success-toast').css('display', 'block');
      }
    })
    .catch(err => {
      $('#error-toast').css('display', 'block');
    })
  });


  $('#register-form').submit(event => {
      event.preventDefault();
      $('#success-toast-register').css('display', 'none');
      $('#error-toast-register').css('display', 'none');

      let email = $('#input-email-register').val();
      let name = $('#input-name-register').val();
      let firstname = $('#input-firstname-register').val();
      let password = $('#input-password-register').val();
      let confirmpass = $('#input-confirm-password-register').val();
      let type = $('#register-type').val();

      let information = {
        "email": email,
        "firstname": firstname,
        "lastname": name,
        "password": password, // parola trebuie sa fie de minim 8 caractere
        "confirmation_password": confirmpass, // acest camp trebuie sa fie identic cu password
        "role": type
      };

      fetch(url + '/auth/register', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + bobobc_token, 
          'Accept': 'application/json',
          'Content-Type': 'application/json',
          'boboc-token': bobobc_token
        },
        body: JSON.stringify(information)
      }).then(response => {
        console.log(response)

        if (response.status < 200 || response.status >= 300) {
          $('#error-toast-register').css('display', 'block');
        } else {
          $('#success-toast-register').css('display', 'block');
        }
      })
      .catch(err => {
        $('#error-toast-register').css('display', 'block');
      });
  }); 

  $('#login-form').submit(event => {
      event.preventDefault();
      $('#success-toast-login').css('display', 'none');
      $('#error-toast-login').css('display', 'none');

      let email = $('#input-email-login').val();
      let password = $('#input-password-login').val();

      let information = {
        "email": email,
        "password": password, // parola trebuie sa fie de minim 8 caractere
      };

      fetch(url + '/auth/login', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + bobobc_token, 
          'Accept': 'application/json',
          'Content-Type': 'application/json',
          'boboc-token': bobobc_token
        },
        body: JSON.stringify(information)
      }).then(response => {
        console.log(response)

        if (response.status < 200 || response.status >= 300) {
          $('#error-toast-login').css('display', 'block');
        } else {
          $('#success-toast-login').css('display', 'block');
        }

        return response.json();
      })
      .then(res => {
        console.log(res.token, email);

        if (res.token !== undefined && res.token !== null) {
          window.localStorage.setItem("token", res.token);

          if (email.includes("@stud.upb.ro")) {
            window.localStorage.setItem("type", "student");
            $('#nav-buttons').html(loggedStudentNavBar);
          } else if (email.includes("@onmicrosoft.upb.ro")) {
            window.localStorage.setItem("type", "profesor");
            $('#nav-buttons').html(loggedTeacherNavBar);
          }

          $('#login-modal').modal('hide');

          $('#logout').click(event => {
            event.preventDefault();
            window.localStorage.removeItem("token");
            window.localStorage.removeItem("type");

            $('#nav-buttons').html(normalNav);
          });
        }
      })
      .catch(err => {
        console.log(err);
        $('#error-toast-login').css('display', 'block');
      });
  });

</script>

</body>

</html>